<?php

namespace Database\Seeders;

use App\Models\Category;
use App\Models\CategoryTranslation;
use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\DB;

class CategorySeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        DB::table('category_translations')->delete();
        DB::table('categories')->delete();
        DB::statement('ALTER TABLE category_translations AUTO_INCREMENT = 1;');
        DB::statement('ALTER TABLE categories AUTO_INCREMENT = 1;');

        $categories = [
            ['code' => '1', 'name' => 'Zákon č. 361/2000Sb. (Pravidla provozu na pozemních komunikacích)'],
            ['code' => '2', 'name' => 'Zásady bezpečné jízdy [A]'],
            ['code' => '3', 'name' => 'Zásady bezpečné jízdy [B]'],
            ['code' => '4', 'name' => 'Zásady bezpečné jízdy [C,D]'],
            ['code' => '5', 'name' => 'Dopravní značky'],
            ['code' => '6', 'name' => 'Řešení dopravních situací'],
            ['code' => '7', 'name' => 'Podmínky provozu vozidel'],
            ['code' => '8', 'name' => 'Související předpisy'],
            ['code' => '9', 'name' => 'Zdravotnická příprava'],                            
        ];

        foreach ($categories as $categoryData) {
            // Vytvoř kategorii
            $category = Category::create([
                'code' => $categoryData['code'],
                'slug' => $this->generateSlug($categoryData['name']),
                'is_active' => true,
            ]);

            // Vytvoř překlad kategorie
            CategoryTranslation::create([
                'category_id' => $category->id,
                'locale' => 'cs',
                'name' => $categoryData['name'],
                'description' => null,
            ]);
        }
    }

    /**
     * Generuje slug z názvu kategorie
     */
    private function generateSlug(string $name): string
    {
        $slug = mb_strtolower($name, 'UTF-8');
        $slug = iconv('UTF-8', 'ASCII//TRANSLIT//IGNORE', $slug);
        $slug = preg_replace('/[^\p{L}0-9\s-]/u', '', $slug);
        $slug = preg_replace('/[\s-]+/u', '-', $slug);
        $slug = trim($slug, '-');

        return $slug;
    }
}


// UPDATE questions SET category_id = 1 WHERE external_id IN (180,187,195,223,237,427,476,479,784,808,1022,1108,1297,1468,1469,1476,1477,1483,1504,1508,1511,1517,1521,1525,1526,1527,1536,1537,1545,1566,1572,1589,1607,1650,2122,2125,2128,2131,2132,2137,2142,2145,2146,2158,2159,2167,2169,2171,2186,2192,2211,2214,2216,2217,2218,2231,2233,2235,2241,2249,2251,2252,2268,2269,2270,2272,2273,2274,2275,2276,2277,2278,2279,2280,2281,2282,2283,2284,2286,2288,2289,2290,2490,2499,2502,2505,2515,2525,2526,2527,2528,2529,2532,2534,2535,2538,2539,2542,2556,2557,2563,2618,2632,2638,2639,2643,2644,2649,2650,2652,2653,2656,2657,2658,2659,2662,2663,2667,2668,2669,2796,2800,2802,2803,2805,2806,2807,2808,2811,2812,2813,2815,2817,2818,2819,2820,2823,2825,2827,2828,2829,2830,2831,2832,2834,2835,2836,2838,2839,2840,2843,2844,2846,2847,2848,2849,2850,2851,2852,2853,2857,2859,2860,2861,2862,2863,2864,2867,2868,2870,2871,2872,2874,2875,2876,2877,2878,2879,2880,2888,2898,2901,2903,2904,2906,2907,2908,2909,2910,2911,2912,2913,2915,2916,2917,2918,2919,2920,2921,2923,2926,2927,2928,2930,2931,2932,2935,2937,2938,2939,2940,2942,2943,2946,2947,2948,2949,2950,2952,2954,2955,2961,2962,2963,2964,2968,2969,2973,2976,2977,2979,2982,2983,2984,2987,2992,3001,3080,3082,3084,3086,3087,3090,3091,3092,3093,3094,3128,3129,3130,3133,3134,3135,3136,3138,3144,3146,3147,3148,3149,3200,3201,3202,3203,3204,3214,3451,3457,3467,3469,4024,4027,4118,4120,4121,4293,4294,4299,4300,4302,4303,4304,4305,4306,4307,4308,4309,4310,4311,4312,4313,4314,4315,4316,4317,4318,4319,4320,4321,4322,4323,4324,4325,4326,4327,4328,4329,4330,4331,4332,4333,4335,4336,4337,4338,4339,4340,4341,4342,4343,4344,4345,4346,4347,4348,4349,4350,4351,4352,4353,4354,4403,4505,4506,4507,4508,4509,4510,4519,4522,4532,4533,4534,4535,4536,4537,4539,4540,4541,4542,4544,4545,4561,4562,5370,5378,5383,5394,5398,5404,5405,5411,5414,5417,5418,5419,5421,5427,5430,5431,5439,5440,5448,5450,5455,5457,5458,5460,5463,5464,5470,5515,5531,5532,5535,5537,5538,5549,5551,5552,5553,5554,5555,5561,5576,5577,5578,5579,5580,5585,5586,5587,5588,5589,5590,5593,5594,5595,5596,5598,5599,5600,5610,5613,5615,5628,5629,5630,5631,5639,5640,5641,5642,5643,5644,5645,5669,5672,5673,5674,5675,5677,5678,5682,5683,5684,5685,5692,5696,5697,104550,104551)
// UPDATE questions SET category_id = 2 WHERE external_id IN (1389,1400,1402,1615,1706,2253,2265,2271,2294,2297,2312,2314,2315,2316,2337,2341,2342,2344,2345,2348,2349,2350,2351,2352,2355,2360,2361,2362,2365,2366,2367,2368,2369,2371,2372,2374,2376,2382,2389,2390,2394,2395,2398,2399,2411,2413,2414,2415,2435,2438,2439,2440,2441,2442,2444,2447,2448,2452,2454,2457,2540,2559,2884,2885,2892,3009,3010,3011,3017,3020,3033,3044,3045,3046,3047,3048,3049,3065,3099,3100,3101,3102,3103,3104,3106,3107,3108,3109,3111,3112,3150,3164,3166,3173,3175,3197,3198,3199,3211,3213,3216,3237,3449,3461,3473,3474,3479,4122,4127,4512,5412,5438,5495,5499,5500,5501,5502,5503,5504,5505,5506,5507,5508,5509,5510,5511,5517,5518,5519,5521,5522,5536,5556,5560,5565,5566,5574,5575,5581,5591,5592,5597,5601,5602,5603,5604,5605,5606,5607,5608,5611,5614,5619,5620,5621,5622,5623,5624,5679,103475)
// UPDATE questions SET category_id = 3 WHERE external_id IN (1389,1400,1402,1615,1706,2253,2265,2271,2294,2297,2312,2314,2315,2316,2337,2341,2342,2344,2345,2348,2349,2350,2351,2352,2355,2360,2361,2362,2365,2366,2367,2368,2369,2371,2372,2374,2376,2382,2389,2390,2394,2395,2398,2399,2411,2413,2414,2415,2435,2438,2439,2440,2441,2442,2444,2447,2448,2452,2454,2457,2540,2559,2884,2885,2892,3009,3010,3011,3017,3020,3033,3044,3045,3046,3047,3048,3049,3065,3099,3100,3101,3102,3103,3104,3106,3107,3108,3109,3111,3112,3150,3164,3166,3173,3175,3197,3198,3199,3211,3213,3216,3237,3449,3461,3473,3474,3479,4122,4127,4512,5412,5438,5495,5499,5500,5501,5502,5503,5504,5505,5506,5507,5508,5509,5510,5511,5517,5518,5519,5521,5522,5536,5556,5560,5565,5566,5574,5575,5581,5591,5592,5597,5601,5602,5603,5604,5605,5606,5607,5608,5611,5614,5619,5620,5621,5622,5623,5624,5679,103475)
// UPDATE questions SET category_id = 4 WHERE external_id IN (1389,1400,1402,1615,1706,2253,2265,2271,2294,2297,2312,2314,2315,2316,2337,2341,2342,2344,2345,2348,2349,2350,2351,2352,2355,2360,2361,2362,2365,2366,2367,2368,2369,2371,2372,2374,2376,2382,2389,2390,2394,2395,2398,2399,2411,2413,2414,2415,2435,2438,2439,2440,2441,2442,2444,2447,2448,2452,2454,2457,2540,2559,2884,2885,2892,3009,3010,3011,3017,3020,3033,3044,3045,3046,3047,3048,3049,3065,3099,3100,3101,3102,3103,3104,3106,3107,3108,3109,3111,3112,3150,3164,3166,3173,3175,3197,3198,3199,3211,3213,3216,3237,3449,3461,3473,3474,3479,4122,4127,4512,5412,5438,5495,5499,5500,5501,5502,5503,5504,5505,5506,5507,5508,5509,5510,5511,5517,5518,5519,5521,5522,5536,5556,5560,5565,5566,5574,5575,5581,5591,5592,5597,5601,5602,5603,5604,5605,5606,5607,5608,5611,5614,5619,5620,5621,5622,5623,5624,5679,103475)
// UPDATE questions SET category_id = 5 WHERE external_id IN ()
// UPDATE questions SET category_id = 6 WHERE external_id IN ()
// UPDATE questions SET category_id = 7 WHERE external_id IN ()
// UPDATE questions SET category_id = 8 WHERE external_id IN ()
// UPDATE questions SET category_id = 9 WHERE external_id IN ()
